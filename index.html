<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>News - Mini CMS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { padding: 20px; }
    .category-bar {
      margin-bottom: 20px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .category-bar button {
      cursor: pointer;
    }
    .card-columns {
      column-count: 1;
    }
    @media(min-width: 576px) {
      .card-columns { column-count: 2; }
    }
    @media(min-width: 992px) {
      .card-columns { column-count: 3; }
    }
  </style>
</head>
<body>
  <h1>News</h1>
  <div class="category-bar" id="categoryBar">
    <!-- Buttons injected here -->
  </div>
  <div id="postsContainer" class="card-columns"></div>

  <script>
    const OWNER = 'https://github.com/Kaungadd181994';    // Replace with your GitHub username
    const REPO = '1001';     // Replace with your repo name
    const BRANCH = 'main';

    let posts = [];
    let categories = new Set();
    let selectedCategory = 'All';

    async function fetchPostsList() {
      const url = `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/posts/list.json`;
      try {
        const res = await fetch(url);
        if(!res.ok) throw new Error('Posts list not found');
        posts = await res.json();
        categories = new Set(posts.map(p => p.category));
        categories = new Set(['All', ...categories]);
      } catch(e) {
        console.error('Error loading posts list:', e);
        posts = [];
        categories = new Set(['All']);
      }
    }

    function renderCategoryBar() {
      const container = document.getElementById('categoryBar');
      container.innerHTML = '';
      categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.textContent = cat;
        btn.className = 'btn btn-outline-primary btn-sm' + (cat === selectedCategory ? ' active' : '');
        btn.addEventListener('click', () => {
          selectedCategory = cat;
          renderCategoryBar();
          renderPosts();
        });
        container.appendChild(btn);
      });
    }

    function renderPosts() {
      const container = document.getElementById('postsContainer');
      container.innerHTML = '';

      let filtered = posts.filter(p => p.status !== 'locked');
      if(selectedCategory !== 'All') {
        filtered = filtered.filter(p => p.category === selectedCategory);
      }

      if(filtered.length === 0){
        container.innerHTML = '<p>No posts available.</p>';
        return;
      }

      filtered.forEach(post => {
        const card = document.createElement('div');
        card.className = 'card mb-3';
        card.style.breakInside = 'avoid';
        card.innerHTML = `
          <div class="card-body">
            <h5 class="card-title"><a href="posts/${post.filename.split('/').pop()}" target="_blank" rel="noopener noreferrer">${post.title}</a></h5>
            <h6 class="card-subtitle mb-2 text-muted">${post.author} â€” ${new Date(post.created_at).toLocaleDateString()}</h6>
            <p class="card-text">${post.category}</p>
          </div>
        `;
        container.appendChild(card);
      });
    }

    (async () => {
      await fetchPostsList();
      renderCategoryBar();
      renderPosts();
    })();
  </script>
</body>
</html>
